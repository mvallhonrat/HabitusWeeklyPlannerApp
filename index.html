<!DOCTYPE html>

<html lang="es">
<head>
<!-- Etiquetas Open Graph para redes sociales -->
<meta content="Habitus - Planificador Semanal" property="og:title"/>
<meta content="Organiza tu semana con claridad y prop√≥sito con Habitus." property="og:description"/>
<meta content="https://mvallhonrat.github.io/HabitusWeeklyPlannerApp/icons/icon-514x5154.png" property="og:image"/>
<meta content="website" property="og:type"/>
<meta content="https://mvallhonrat.github.io/HabitusWeeklyPlannerApp/" property="og:url"/>
<!-- Etiquetas Twitter Card -->
<meta content="summary_large_image" name="twitter:card"/>
<meta content="Habitus - Planificador Semanal" name="twitter:title"/>
<meta content="Organiza tu semana con claridad y prop√≥sito con Habitus." name="twitter:description"/>
<meta content="https://mvallhonrat.github.io/HabitusWeeklyPlannerApp/icons/icon-514x5154.png" name="twitter:image"/>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" name="viewport"/>
<meta content="#4f46e5" name="theme-color"/>
<meta content="Planificador Semanal basado en la Matriz de Prioridades" name="description"/>
<meta content="yes" name="apple-mobile-web-app-capable"/>
<meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"/>
<title data-i18n="title">Habitus - Planificador Semanal</title>
<!-- Cargar Tailwind CSS desde CDN -->
<div class="bg-white rounded-lg shadow-md p-4 mb-6 max-w-2xl mx-auto text-center">
<div class="flex justify-center mb-4 px-4 sm:px-6">
<div class="flex flex-col items-center justify-center mb-4 px-4 text-center">
<img alt="Logo Habitus" class="w-24 h-24 object-contain mb-2" src="icons/icon-192x192.png"/>
<h1 class="text-2xl sm:text-3xl font-bold text-gray-800 mb-1" data-i18n="title">Planificador Semanal</h1>
</div>
</div>
<div class="mb-6" id="pasaje-inspirador">
    <div class="text-gray-700 text-center mt-2" id="verso-contenedor">
        <!-- The inspirational quote will be loaded here dynamically -->
        <div class="bg-white rounded-lg shadow-sm p-4">
            <p class="text-lg font-medium text-gray-800">Cargando vers√≠culo...</p>
            <p class="text-sm text-gray-600 mt-2 italic">Por favor espera...</p>
        </div>
    </div>
</div></div><script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@3"></script>
<link href="manifest.json" rel="manifest"/>
<link href="icons/icon-192x192.png" rel="apple-touch-icon"/>
<style>
    /* Optimizaciones para m√≥vil */
    @media (max-width: 640px) {
      .text-2xl {
        font-size: 1.5rem;
      }
      .text-xl {
        font-size: 1.25rem;
      }
      .p-4 {
        padding: 0.75rem;
      }
      /* Aumentar tama√±o de elementos interactivos para m√≥vil */
      button, input[type="text"], select, textarea {
        min-height: 44px;
      }
      /* Aumentar espaciado entre elementos */
      .space-y-1 > * + * {
        margin-top: 0.5rem;
      }
    }

    /* Mejorar rendimiento t√°ctil */
    .touch-manipulation {
      touch-action: manipulation;
    }

    /* Prevenir selecci√≥n de texto en elementos interactivos */
    .no-select {
      user-select: none;
    }

    /* Estilos para modo standalone en iOS */
    @supports (-webkit-touch-callout: none) {
      .ios-standalone {
        padding-top: env(safe-area-inset-top);
        padding-bottom: env(safe-area-inset-bottom);
      }
    }

    /* Language switch styles */
    .lang-switch {
        position: relative;
        display: inline-block;
        width: 100px;
        height: 32px;
        background-color: #e5e7eb;
        border-radius: 16px;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .lang-switch::before {
        content: '';
        position: absolute;
        width: 48px;
        height: 24px;
        border-radius: 12px;
        background-color: white;
        top: 4px;
        left: 4px;
        transition: all 0.3s ease;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    .lang-switch.active::before {
        transform: translateX(44px);
    }

    .lang-switch-text {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        font-size: 12px;
        font-weight: 600;
        color: #4b5563;
        transition: all 0.3s ease;
    }

    .lang-switch-text.es {
        left: 12px;
    }

    .lang-switch-text.en {
        right: 12px;
    }

    .lang-switch.active .lang-switch-text.es {
        color: #4b5563;
    }

    .lang-switch.active .lang-switch-text.en {
        color: white;
    }

    .lang-switch:not(.active) .lang-switch-text.es {
        color: white;
    }

    .lang-switch:not(.active) .lang-switch-text.en {
        color: #4b5563;
    }
</style>
<link rel="stylesheet" href="styles.css">
<link href="./icons/icon-192x192.png" rel="icon" type="image/png"/></head>
<body class="bg-gray-50 text-gray-800 p-4 antialiased ios-standalone">
<div class="absolute top-4 right-4 text-sm text-gray-600" id="langSelector">
    <div class="lang-switch" id="langSwitch">
        <span class="lang-switch-text es">ES</span>
        <span class="lang-switch-text en">EN</span>
    </div>
</div>
<!-- T√≠tulo principal -->
<!-- Recuadro de instrucciones - Colapsable en m√≥vil -->
<div class="bg-blue-100 border-l-4 border-blue-500 text-blue-900 p-3 mb-4 rounded">
<div class="flex items-center cursor-pointer gap-2" onclick="toggleInstructions()">
<button class="text-blue-700 hover:text-blue-900" id="instructionsToggle">‚ñº</button>
<h3 class="font-medium no-select" data-i18n="instructions_title">üìñ Instrucciones de uso</h3>
</div>
<div class="mt-2" id="instructionsContent">
<ul class="list-disc list-inside text-sm space-y-2">
<li data-i18n="inst_1">üé≠ <strong>Define tus Roles:</strong> Identifica los roles importantes en tu vida (por ejemplo: Padre, Profesional, Amigo). Estos ser√°n las categor√≠as bajo las cuales organizar√°s tus tareas semanales.</li>
<li data-i18n="inst_2">üìù <strong>Agrega tus Tareas:</strong> Para cada rol, a√±ade las tareas que deseas realizar esta semana. Escribe una breve descripci√≥n y asigna el cuadrante correspondiente seg√∫n su urgencia e importancia.</li>
<li data-i18n="inst_3">üî¢ Prioriza con los Cuadrantes: Utiliza la Matriz de Prioridades (I-IV) para clasificar cada tarea:</li>
<div class="ml-6 mt-1 text-sm" data-i18n="inst_3_sub">
    <ul class="list-none ml-4 mt-1">
        <li data-i18n="inst_4">I ‚Äì Urgente e Importante (hacer de inmediato).</li>
        <li data-i18n="inst_5">II ‚Äì No Urgente e Importante (planificar tiempo para hacer).</li>
        <li data-i18n="inst_6">III ‚Äì Urgente y No Importante (intentar delegar o minimizar).</li>
        <li data-i18n="inst_7">IV ‚Äì No Urgente y No Importante (evitar en lo posible).</li>
    </ul>
</div>
<li data-i18n="inst_8">‚úÖ <strong>Marca las Completadas:</strong> A medida que termines cada tarea, m√°rcala como realizada con la casilla de verificaci√≥n.</li>
<li data-i18n="inst_9">üîÑ <strong>Vista de Roles/Cuadrantes:</strong> Alterna entre la vista agrupada por roles o por cuadrantes usando las pesta√±as para obtener diferentes perspectivas de tus tareas.</li>
<li data-i18n="inst_10">üìä <strong>Revisa tus M√©tricas:</strong> Al finalizar la semana, revisa el resumen de tareas completadas y pendientes, y reflexiona sobre tu semana en Revisi√≥n Semanal.</li>
<li data-i18n="inst_11">üìã <strong>Exporta y Reinicia:</strong> Guarda un registro de tu semana utilizando Exportar M√©tricas y Exportar Tareas. Luego comienza una nueva semana con el bot√≥n Nueva Semana: solo las tareas completadas se remover√°n, las pendientes permanecer√°n para la siguiente semana.</li>
</ul>
</div>
</div>
<!-- Secci√≥n de Roles -->
<div class="mb-6">
<h2 class="text-xl font-semibold mb-2 no-select" data-i18n="roles">üé≠ Definir Roles</h2>
<div class="flex gap-2">
<input class="border rounded px-3 py-2 flex-1 touch-manipulation" data-i18n-placeholder="placeholder_role" id="roleInput" placeholder="Nuevo rol..." type="text"/>
<button class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 active:bg-blue-700 touch-manipulation" data-i18n="add_role" id="addRoleBtn">
        ‚ûï A√±adir Rol
      </button>
</div>
<div class="mt-2 space-y-1" id="rolesList"><!-- Lista de roles din√°micos --></div>
</div>
<!-- Controles: pesta√±as y formulario -->
<div class="mb-4">
<!-- Pesta√±as Roles / Cuadrantes -->
<div class="flex border-b border-gray-300 mb-3 no-select">
<button class="flex-1 px-3 py-3 text-sm font-medium text-gray-700 border-b-2 border-indigo-500 touch-manipulation" data-i18n="tabs_roles" id="tabRoles">Por Roles</button>
<button class="flex-1 px-3 py-3 text-sm font-medium text-gray-600 hover:text-gray-800 border-b-2 border-transparent touch-manipulation" data-i18n="tabs_quadrants" id="tabQuadrants">Por Cuadrantes</button>
</div>
<!-- Recordatorio de la √∫ltima revisi√≥n -->
<div class="bg-yellow-100 border-l-4 border-yellow-500 text-yellow-900 p-3 mb-4 text-sm italic hidden" id="lastReviewBox">
      üìå <strong>Recuerda esto de la semana anterior:</strong> <span id="lastReviewText"></span>
</div>
<!-- Formulario de nueva tarea -->
<div class="mb-2">
<label class="block text-sm font-medium mb-1" data-i18n="label_task" for="taskInput">Nueva Tarea:</label>
<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-2">
<input class="border rounded px-3 py-2 text-sm w-full touch-manipulation" data-i18n-placeholder="placeholder_task" id="taskInput" placeholder="Descripci√≥n de la tarea" type="text"/>
<select class="border rounded px-3 py-2 text-sm w-full touch-manipulation" id="roleSelect">
<option disabled="" selected="" value="">Rol</option>
</select>
<select class="border rounded px-3 py-2 text-sm w-full touch-manipulation" id="quadrantSelect">
<option disabled="" selected="" value="">Cuadrante</option>
<option value="1">I - Urgente/Importante</option>
<option value="2">II - No Urgente/Importante</option>
<option value="3">III - Urgente/No Importante</option>
<option value="4">IV - No Urgente/No Importante</option>
</select>
<button class="bg-green-500 text-white text-sm px-3 py-2 rounded hover:bg-green-600 active:bg-green-700 w-full touch-manipulation" data-i18n="add_task_button" id="addTaskBtn">
          ‚úîÔ∏è A√±adir Tarea
        </button>
</div>
</div>
</div>
<!-- Vistas de tareas -->
<div class="mb-6 overflow-x-hidden" id="rolesView"></div>
<div class="mb-6 hidden overflow-x-hidden" id="quadrantsView"></div>
<!-- Secci√≥n de gr√°ficos -->
<div class="mb-6">
<div class="grid grid-cols-1 md:grid-cols-2 gap-4">
<div class="bg-white p-4 rounded shadow-sm">
<h3 class="text-lg font-semibold mb-2" data-i18n="metric_quadrants">Tareas por Cuadrante</h3>
<div class="w-full h-[300px]">
<canvas id="chartQuadrants"></canvas>
</div>
</div>
<div class="bg-white p-4 rounded shadow-sm">
<h3 class="text-lg font-semibold mb-2" data-i18n="chart_title_completion">Completadas vs Pendientes</h3>
<div class="w-full h-[300px]">
<canvas id="chartCompletion"></canvas>
</div>
</div>
</div>
</div>
<!-- Secci√≥n de revisi√≥n y controles -->
<div class="mb-4">
<label class="block text-sm font-medium mb-1" data-i18n="label_review" for="reviewInput">üìù Revisi√≥n semanal:</label>
<textarea class="w-full border rounded px-3 py-2 text-sm touch-manipulation" data-i18n-placeholder="placeholder_review" id="reviewInput" placeholder="Escribe aqu√≠ una reflexi√≥n sobre tu semana..." rows="3"></textarea>
<button class="mt-3 bg-purple-600 text-white text-sm font-medium px-4 py-3 rounded hover:bg-purple-700 active:bg-purple-800 w-full sm:w-auto touch-manipulation" data-i18n="new_week" id="newWeekBtn">
      üåÖ Nueva Semana
    </button>
</div>
<!-- Secci√≥n de m√©tricas hist√≥ricas -->
<div class="mb-6">
<h2 class="text-xl font-semibold mb-4">üìä M√©tricas Hist√≥ricas</h2>
<!-- Resumen de m√©tricas actuales -->
<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
<div class="bg-white p-4 rounded shadow-sm">
<h3 class="text-sm font-medium text-gray-500" data-i18n="metric_total">Total de Tareas</h3>
<p class="text-2xl font-bold" id="totalTasks">0</p>
</div>
<div class="bg-white p-4 rounded shadow-sm">
<h3 class="text-sm font-medium text-gray-500" data-i18n="metric_percent">Porcentaje Completado</h3>
<p class="text-2xl font-bold" id="completionPercentage">0%</p>
</div>
<div class="bg-white p-4 rounded shadow-sm">
<h3 class="text-sm font-medium text-gray-500" data-i18n="metric_roles">Roles Activos</h3>
<p class="text-2xl font-bold" id="activeRoles">0</p>
</div>
<div class="bg-white p-4 rounded shadow-sm">
<h3 class="text-sm font-medium text-gray-500" data-i18n="metric_quadrants">Tareas por Cuadrante</h3>
<div class="grid grid-cols-2 gap-2 mt-2">
<div>
<span class="text-xs text-red-500">Q1:</span>
<span class="text-sm font-medium" id="q1Count">0</span>
</div>
<div>
<span class="text-xs text-green-500">Q2:</span>
<span class="text-sm font-medium" id="q2Count">0</span>
</div>
<div>
<span class="text-xs text-yellow-500">Q3:</span>
<span class="text-sm font-medium" id="q3Count">0</span>
</div>
<div>
<span class="text-xs text-gray-500">Q4:</span>
<span class="text-sm font-medium" id="q4Count">0</span>
</div>
</div>
</div>
</div>
<!-- Gr√°ficos hist√≥ricos -->
<div class="grid grid-cols-1 gap-4">
<div class="bg-white p-4 rounded shadow-sm">
<h3 class="text-lg font-semibold mb-2" data-i18n="chart_completion_title">Porcentaje de Completado por Semana</h3>
<div class="w-full h-[300px]">
<canvas id="chartHistoricalCompletion"></canvas>
</div>
</div>
<div class="bg-white p-4 rounded shadow-sm">
<h3 class="text-lg font-semibold mb-2" data-i18n="chart_quadrants_title">Tareas por Cuadrante por Semana</h3>
<div class="w-full h-[300px]">
<canvas id="chartHistoricalQuadrants"></canvas>
</div>
</div>
<div class="bg-white p-4 rounded shadow-sm">
<h3 class="text-lg font-semibold mb-2" data-i18n="chart_roles_title">Roles Activos por Semana</h3>
<div class="w-full h-[300px]">
<canvas id="chartHistoricalRoles"></canvas>
</div>
</div>
</div>
</div>
<!-- Botones de exportaci√≥n -->
<div class="mb-4 grid grid-cols-2 gap-2">
  <button class="bg-gray-300 text-gray-800 text-sm px-4 py-3 rounded hover:bg-gray-400 active:bg-gray-500 touch-manipulation" data-i18n="export_metrics" id="exportMetricsBtn">
    üì• Exportar M√©tricas
  </button>
  <button class="bg-gray-300 text-gray-800 text-sm px-4 py-3 rounded hover:bg-gray-400 active:bg-gray-500 touch-manipulation" data-i18n="export_tasks" id="exportTasksBtn">
    üì• Exportar Tareas
  </button>
</div>
<!-- Bot√≥n de migraci√≥n -->
<div class="mb-4">
  <button id="migrateDataBtn" class="bg-blue-500 text-white text-sm px-4 py-3 rounded hover:bg-blue-600 active:bg-blue-700 w-full touch-manipulation">
    üîÑ Migrar Datos Existentes
  </button>
</div>
<!-- Create hidden data elements -->
<div id="translations-data" style="display: none;"></div>
<div id="passages-data" style="display: none;"></div>

<!-- Load scripts in correct order with defer -->
<script src="pasajes_bilingues.js" defer></script>
<script src="translations.js" defer></script>
<script src="roles.js" defer></script>
<script src="tasks.js" defer></script>
<script src="app.js" defer></script>

<script>
// Global error handler
window.onerror = function(msg, url, lineNo, columnNo, error) {
    console.error('Global error:', { msg, url, lineNo, columnNo, error });
    return false;
};

// Initialize application
async function initApp() {
    try {
        console.log('Starting application initialization...');
        
        // Wait for all scripts to load
        await Promise.all([
            new Promise(resolve => {
                if (document.readyState === 'complete') resolve();
                else window.addEventListener('load', resolve);
            }),
            // Ensure pasajes_bilingues.js is loaded
            new Promise(resolve => {
                if (window.PASAJES_BILINGUES) resolve();
                else {
                    const checkInterval = setInterval(() => {
                        if (window.PASAJES_BILINGUES) {
                            clearInterval(checkInterval);
                            resolve();
                        }
                    }, 100);
                }
            })
        ]);
        
        // Initialize App module
        await App.init();
        
        // Set up export buttons
        document.getElementById('exportMetricsBtn')?.addEventListener('click', Tasks.exportMetrics);
        document.getElementById('exportTasksBtn')?.addEventListener('click', Tasks.exportTasks);
        
        // Set up migration button
        document.getElementById('migrateDataBtn')?.addEventListener('click', migrateData);
        
        console.log('Application initialized successfully');
    } catch (error) {
        console.error('Error initializing application:', error);
    }
}

// Data migration function
async function migrateData() {
    try {
        // Get old data
        const oldTasks = JSON.parse(localStorage.getItem('habitus_tasks') || '[]');
        const oldMetrics = JSON.parse(localStorage.getItem('habitus_metrics') || '[]');
        const oldTasksLog = JSON.parse(localStorage.getItem('habitus_tasksLog') || '[]');
        const oldLastReview = localStorage.getItem('habitus_lastReview') || '';
        const oldLastReset = localStorage.getItem('habitus_lastReset');
        const oldRoles = JSON.parse(localStorage.getItem('habitus_roles') || '[]');
        
        // Backup old data
        localStorage.setItem('habitus_tasks_backup', JSON.stringify(oldTasks));
        localStorage.setItem('habitus_metrics_backup', JSON.stringify(oldMetrics));
        localStorage.setItem('habitus_tasksLog_backup', JSON.stringify(oldTasksLog));
        localStorage.setItem('habitus_lastReview_backup', oldLastReview);
        localStorage.setItem('habitus_lastReset_backup', oldLastReset || '');
        localStorage.setItem('habitus_roles_backup', JSON.stringify(oldRoles));
        
        // Migrate tasks to new format
        const newTasks = oldTasks.map(task => ({
            ...task,
            quadrant: task.quadrant?.toString() || '1', // Ensure quadrant is a string
            role: task.role || 'Default', // Ensure role exists
            completed: Boolean(task.completed), // Ensure completed is boolean
            createdAt: task.createdAt || new Date().toISOString() // Ensure createdAt exists
        }));
        
        // Save new data
        localStorage.setItem('habitus_tasks', JSON.stringify(newTasks));
        localStorage.setItem('habitus_metrics', JSON.stringify(oldMetrics));
        localStorage.setItem('habitus_tasksLog', JSON.stringify(oldTasksLog));
        localStorage.setItem('habitus_lastReview', oldLastReview);
        localStorage.setItem('habitus_lastReset', oldLastReset || '');
        localStorage.setItem('habitus_roles', JSON.stringify(oldRoles));
        
        // Refresh the UI
        window.location.reload();
        
        App.showNotification('Data migration completed successfully', 'success');
    } catch (error) {
        console.error('Error during data migration:', error);
        App.showNotification('Error during data migration', 'error');
    }
}

// Initialize app when DOM is loaded
document.addEventListener('DOMContentLoaded', initApp);

// Register service worker
if ('serviceWorker' in navigator) {
    window.addEventListener('load', async () => {
        try {
            const registration = await navigator.serviceWorker.register('./service-worker.js', {
                scope: './'
            });
            console.log('ServiceWorker registration successful:', registration);
        } catch (err) {
            console.error('ServiceWorker registration failed:', err);
        }
    });
}
</script>
