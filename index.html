<!DOCTYPE html>

<html lang="es">
<head>
<!-- Etiquetas Open Graph para redes sociales -->
<meta content="Habitus - Planificador Semanal" property="og:title"/>
<meta content="Organiza tu semana con claridad y prop√≥sito con Habitus." property="og:description"/>
<meta content="https://mvallhonrat.github.io/HabitusWeeklyPlannerApp/icons/icon-514x5154.png" property="og:image"/>
<meta content="website" property="og:type"/>
<meta content="https://mvallhonrat.github.io/HabitusWeeklyPlannerApp/" property="og:url"/>
<!-- Etiquetas Twitter Card -->
<meta content="summary_large_image" name="twitter:card"/>
<meta content="Habitus - Planificador Semanal" name="twitter:title"/>
<meta content="Organiza tu semana con claridad y prop√≥sito con Habitus." name="twitter:description"/>
<meta content="https://mvallhonrat.github.io/HabitusWeeklyPlannerApp/icons/icon-514x5154.png" name="twitter:image"/>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" name="viewport"/>
<meta content="#4f46e5" name="theme-color"/>
<meta content="Planificador Semanal basado en la Matriz de Prioridades" name="description"/>
<meta content="yes" name="apple-mobile-web-app-capable"/>
<meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"/>
<title data-i18n="title">Habitus - Planificador Semanal</title>
<!-- Cargar Tailwind CSS desde CDN -->
<div class="bg-white rounded-lg shadow-md p-4 mb-6 max-w-2xl mx-auto text-center">
<div class="flex justify-center mb-4 px-4 sm:px-6">
<div class="flex flex-col items-center justify-center mb-4 px-4 text-center">
<img alt="Logo Habitus" class="w-24 h-24 object-contain mb-2" src="icons/icon-192x192.png"/>
<h1 class="text-2xl sm:text-3xl font-bold text-gray-800 mb-1" data-i18n="title">Planificador Semanal</h1>
</div>
</div>
<div class="mb-6" id="pasaje-inspirador">
    <div class="text-gray-700 text-center mt-2" id="verso-contenedor">
        <!-- The inspirational quote will be loaded here dynamically -->
        <div class="bg-white rounded-lg shadow-sm p-4">
            <p class="text-lg font-medium text-gray-800">Cargando vers√≠culo...</p>
            <p class="text-sm text-gray-600 mt-2 italic">Por favor espera...</p>
        </div>
    </div>
</div></div><script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@3"></script>
<link href="manifest.json" rel="manifest"/>
<link href="icons/icon-192x192.png" rel="apple-touch-icon"/>
<style>
    /* Optimizaciones para m√≥vil */
    @media (max-width: 640px) {
      .text-2xl {
        font-size: 1.5rem;
      }
      .text-xl {
        font-size: 1.25rem;
      }
      .p-4 {
        padding: 0.75rem;
      }
      /* Aumentar tama√±o de elementos interactivos para m√≥vil */
      button, input[type="text"], select, textarea {
        min-height: 44px;
      }
      /* Aumentar espaciado entre elementos */
      .space-y-1 > * + * {
        margin-top: 0.5rem;
      }
    }

    /* Mejorar rendimiento t√°ctil */
    .touch-manipulation {
      touch-action: manipulation;
    }

    /* Prevenir selecci√≥n de texto en elementos interactivos */
    .no-select {
      user-select: none;
    }

    /* Estilos para modo standalone en iOS */
    @supports (-webkit-touch-callout: none) {
      .ios-standalone {
        padding-top: env(safe-area-inset-top);
        padding-bottom: env(safe-area-inset-bottom);
      }
    }

    /* Language switch styles */
    .lang-switch {
        position: relative;
        display: inline-block;
        width: 100px;
        height: 32px;
        background-color: #e5e7eb;
        border-radius: 16px;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .lang-switch::before {
        content: '';
        position: absolute;
        width: 48px;
        height: 24px;
        border-radius: 12px;
        background-color: white;
        top: 4px;
        left: 4px;
        transition: all 0.3s ease;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    .lang-switch.active::before {
        transform: translateX(44px);
    }

    .lang-switch-text {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        font-size: 12px;
        font-weight: 600;
        color: #4b5563;
        transition: all 0.3s ease;
    }

    .lang-switch-text.es {
        left: 12px;
    }

    .lang-switch-text.en {
        right: 12px;
    }

    .lang-switch.active .lang-switch-text.es {
        color: #4b5563;
    }

    .lang-switch.active .lang-switch-text.en {
        color: white;
    }

    .lang-switch:not(.active) .lang-switch-text.es {
        color: white;
    }

    .lang-switch:not(.active) .lang-switch-text.en {
        color: #4b5563;
    }
</style>
<link rel="stylesheet" href="styles.css">
<link href="./icons/icon-192x192.png" rel="icon" type="image/png"/></head>
<body class="bg-gray-50 text-gray-800 p-4 antialiased ios-standalone">
<!-- T√≠tulo principal -->
<!-- Recuadro de instrucciones - Colapsable en m√≥vil -->
<div class="bg-blue-100 border-l-4 border-blue-500 text-blue-900 p-3 mb-4 rounded">
<div class="flex items-center cursor-pointer gap-2" onclick="toggleInstructions()">
<button class="text-blue-700 hover:text-blue-900" id="instructionsToggle">‚ñº</button>
<h3 class="font-medium no-select" data-i18n="instructions_title">üìñ Instrucciones de uso</h3>
</div>
<div class="mt-2" id="instructionsContent">
<ul class="list-disc list-inside text-sm space-y-2">
<li data-i18n="inst_1">üé≠ <strong>Define tus Roles:</strong> Identifica los roles importantes en tu vida (por ejemplo: Padre, Profesional, Amigo). Estos ser√°n las categor√≠as bajo las cuales organizar√°s tus tareas semanales.</li>
<li data-i18n="inst_2">üìù <strong>Agrega tus Tareas:</strong> Para cada rol, a√±ade las tareas que deseas realizar esta semana. Escribe una breve descripci√≥n y asigna el cuadrante correspondiente seg√∫n su urgencia e importancia.</li>
<li data-i18n="inst_3">üî¢ Prioriza con los Cuadrantes: Utiliza la Matriz de Prioridades (I-IV) para clasificar cada tarea:</li>
<div class="ml-6 mt-1 text-sm" data-i18n="inst_3_sub">
    <ul class="list-none ml-4 mt-1">
        <li data-i18n="inst_4">I ‚Äì Urgente e Importante (hacer de inmediato).</li>
        <li data-i18n="inst_5">II ‚Äì No Urgente e Importante (planificar tiempo para hacer).</li>
        <li data-i18n="inst_6">III ‚Äì Urgente y No Importante (intentar delegar o minimizar).</li>
        <li data-i18n="inst_7">IV ‚Äì No Urgente y No Importante (evitar en lo posible).</li>
    </ul>
</div>
<li data-i18n="inst_8">‚úÖ <strong>Marca las Completadas:</strong> A medida que termines cada tarea, m√°rcala como realizada con la casilla de verificaci√≥n.</li>
<li data-i18n="inst_9">üîÑ <strong>Vista de Roles/Cuadrantes:</strong> Alterna entre la vista agrupada por roles o por cuadrantes usando las pesta√±as para obtener diferentes perspectivas de tus tareas.</li>
<li data-i18n="inst_10">üìä <strong>Revisa tus M√©tricas:</strong> Al finalizar la semana, revisa el resumen de tareas completadas y pendientes, y reflexiona sobre tu semana en Revisi√≥n Semanal.</li>
<li data-i18n="inst_11">üìã <strong>Exporta y Reinicia:</strong> Guarda un registro de tu semana utilizando Exportar M√©tricas y Exportar Tareas. Luego comienza una nueva semana con el bot√≥n Nueva Semana: solo las tareas completadas se remover√°n, las pendientes permanecer√°n para la siguiente semana.</li>
</ul>
</div>
</div>
<!-- Secci√≥n de Roles -->
<div class="mb-6">
<h2 class="text-xl font-semibold mb-2 no-select" data-i18n="roles">üé≠ Definir Roles</h2>
<div class="flex gap-2">
<input class="border rounded px-3 py-2 flex-1 touch-manipulation" data-i18n-placeholder="placeholder_role" id="roleInput" placeholder="Nuevo rol..." type="text"/>
<button class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 active:bg-blue-700 touch-manipulation" data-i18n="add_role" id="addRoleBtn">
        ‚ûï A√±adir Rol
      </button>
</div>
<div class="mt-2 space-y-1" id="rolesList"><!-- Lista de roles din√°micos --></div>
</div>
<!-- Controles: pesta√±as y formulario -->
<div class="mb-4">
<!-- Pesta√±as Roles / Cuadrantes -->
<div class="flex border-b border-gray-300 mb-3 no-select">
<button class="flex-1 px-3 py-3 text-sm font-medium text-gray-700 border-b-2 border-indigo-500 touch-manipulation" data-i18n="tabs_roles" id="tabRoles">Por Roles</button>
<button class="flex-1 px-3 py-3 text-sm font-medium text-gray-600 hover:text-gray-800 border-b-2 border-transparent touch-manipulation" data-i18n="tabs_quadrants" id="tabQuadrants">Por Cuadrantes</button>
</div>
<!-- Recordatorio de la √∫ltima revisi√≥n -->
<div class="bg-yellow-100 border-l-4 border-yellow-500 text-yellow-900 p-3 mb-4 text-sm italic hidden" id="lastReviewBox">
      üìå <strong>Recuerda esto de la semana anterior:</strong> <span id="lastReviewText"></span>
</div>
<!-- Formulario de nueva tarea -->
<div class="mb-2">
<label class="block text-sm font-medium mb-1" data-i18n="label_task" for="taskInput">Nueva Tarea:</label>
<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-2">
<input class="border rounded px-3 py-2 text-sm w-full touch-manipulation" data-i18n-placeholder="placeholder_task" id="taskInput" placeholder="Descripci√≥n de la tarea" type="text"/>
<select class="border rounded px-3 py-2 text-sm w-full touch-manipulation" id="roleSelect">
<option disabled="" selected="" value="">Rol</option>
</select>
<select class="border rounded px-3 py-2 text-sm w-full touch-manipulation" id="quadrantSelect">
<option disabled="" selected="" value="">Cuadrante</option>
<option value="1">I - Urgente/Importante</option>
<option value="2">II - No Urgente/Importante</option>
<option value="3">III - Urgente/No Importante</option>
<option value="4">IV - No Urgente/No Importante</option>
</select>
<button class="bg-green-500 text-white text-sm px-3 py-2 rounded hover:bg-green-600 active:bg-green-700 w-full touch-manipulation" data-i18n="add_task_button" id="addTaskBtn">
          ‚úîÔ∏è A√±adir Tarea
        </button>
</div>
</div>
</div>
<!-- Vistas de tareas -->
<div class="mb-6 overflow-x-hidden" id="rolesView"></div>
<div class="mb-6 hidden overflow-x-hidden" id="quadrantsView"></div>
<!-- Secci√≥n de gr√°ficos -->
<div class="mb-6">
<div class="grid grid-cols-1 md:grid-cols-2 gap-4">
<div class="bg-white p-4 rounded shadow-sm">
<h3 class="text-lg font-semibold mb-2" data-i18n="metric_quadrants">Tareas por Cuadrante</h3>
<div class="w-full h-[300px]">
<canvas id="chartQuadrants"></canvas>
</div>
</div>
<div class="bg-white p-4 rounded shadow-sm">
<h3 class="text-lg font-semibold mb-2" data-i18n="chart_title_completion">Completadas vs Pendientes</h3>
<div class="w-full h-[300px]">
<canvas id="chartCompletion"></canvas>
</div>
</div>
</div>
</div>
<!-- Secci√≥n de revisi√≥n y controles -->
<div class="mb-4">
<label class="block text-sm font-medium mb-1" data-i18n="label_review" for="reviewInput">üìù Revisi√≥n semanal:</label>
<textarea class="w-full border rounded px-3 py-2 text-sm touch-manipulation" data-i18n-placeholder="placeholder_review" id="reviewInput" placeholder="Escribe aqu√≠ una reflexi√≥n sobre tu semana..." rows="3"></textarea>
<button class="mt-3 bg-purple-600 text-white text-sm font-medium px-4 py-3 rounded hover:bg-purple-700 active:bg-purple-800 w-full sm:w-auto touch-manipulation" data-i18n="new_week" id="newWeekBtn">
      üåÖ Nueva Semana
    </button>
</div>
<!-- Secci√≥n de m√©tricas hist√≥ricas -->
<div class="mb-6">
<h2 class="text-xl font-semibold mb-4">üìä M√©tricas Hist√≥ricas</h2>
<!-- Resumen de m√©tricas actuales -->
<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
<div class="bg-white p-4 rounded shadow-sm">
<h3 class="text-sm font-medium text-gray-500" data-i18n="metric_total">Total de Tareas</h3>
<p class="text-2xl font-bold" id="totalTasks">0</p>
</div>
<div class="bg-white p-4 rounded shadow-sm">
<h3 class="text-sm font-medium text-gray-500" data-i18n="metric_percent">Porcentaje Completado</h3>
<p class="text-2xl font-bold" id="completionPercentage">0%</p>
</div>
<div class="bg-white p-4 rounded shadow-sm">
<h3 class="text-sm font-medium text-gray-500" data-i18n="metric_roles">Roles Activos</h3>
<p class="text-2xl font-bold" id="activeRoles">0</p>
</div>
<div class="bg-white p-4 rounded shadow-sm">
<h3 class="text-sm font-medium text-gray-500" data-i18n="metric_quadrants">Tareas por Cuadrante</h3>
<div class="grid grid-cols-2 gap-2 mt-2">
<div>
<span class="text-xs text-red-500">Q1:</span>
<span class="text-sm font-medium" id="q1Count">0</span>
</div>
<div>
<span class="text-xs text-green-500">Q2:</span>
<span class="text-sm font-medium" id="q2Count">0</span>
</div>
<div>
<span class="text-xs text-yellow-500">Q3:</span>
<span class="text-sm font-medium" id="q3Count">0</span>
</div>
<div>
<span class="text-xs text-gray-500">Q4:</span>
<span class="text-sm font-medium" id="q4Count">0</span>
</div>
</div>
</div>
</div>
<!-- Gr√°ficos hist√≥ricos -->
<div class="grid grid-cols-1 gap-4">
<div class="bg-white p-4 rounded shadow-sm">
<h3 class="text-lg font-semibold mb-2" data-i18n="chart_completion_title">Porcentaje de Completado por Semana</h3>
<div class="w-full h-[300px]">
<canvas id="chartHistoricalCompletion"></canvas>
</div>
</div>
<div class="bg-white p-4 rounded shadow-sm">
<h3 class="text-lg font-semibold mb-2" data-i18n="chart_quadrants_title">Tareas por Cuadrante por Semana</h3>
<div class="w-full h-[300px]">
<canvas id="chartHistoricalQuadrants"></canvas>
</div>
</div>
<div class="bg-white p-4 rounded shadow-sm">
<h3 class="text-lg font-semibold mb-2" data-i18n="chart_roles_title">Roles Activos por Semana</h3>
<div class="w-full h-[300px]">
<canvas id="chartHistoricalRoles"></canvas>
</div>
</div>
</div>
</div>
<!-- Botones de exportaci√≥n -->
<div class="mb-4 grid grid-cols-2 gap-2">
  <button class="bg-gray-300 text-gray-800 text-sm px-4 py-3 rounded hover:bg-gray-400 active:bg-gray-500 touch-manipulation" data-i18n="export_metrics" id="exportMetricsBtn">
    üì• Exportar M√©tricas
  </button>
  <button class="bg-gray-300 text-gray-800 text-sm px-4 py-3 rounded hover:bg-gray-400 active:bg-gray-500 touch-manipulation" data-i18n="export_tasks" id="exportTasksBtn">
    üì• Exportar Tareas
  </button>
</div>
<!-- Bot√≥n de migraci√≥n -->
<div class="mb-4">
  <button id="migrateDataBtn" class="bg-blue-500 text-white text-sm px-4 py-3 rounded hover:bg-blue-600 active:bg-blue-700 w-full touch-manipulation">
    üîÑ Migrar Datos Existentes
  </button>
</div>
<!-- Create hidden data elements -->
<div id="translations-data" style="display: none;"></div>
<div id="passages-data" style="display: none;"></div>

<!-- Load scripts in correct order -->
<script>
// Define global namespace for modules
window.Habitus = window.Habitus || {};

// Helper function to determine if running on a web server
function isWebServer() {
    return window.location.protocol === 'http:' || window.location.protocol === 'https:';
}

// Helper function to get correct script path
function getScriptPath(path) {
    // If running on web server, use absolute path from root
    // If running locally, use relative path
    return isWebServer() ? path : path.replace(/^\//, './');
}

// Load scripts dynamically to ensure proper order
async function loadScripts() {
    const scripts = [
        'translations.js',
        'roles.js',
        'tasks.js',
        'app.js'
    ];

    for (const script of scripts) {
        await new Promise((resolve, reject) => {
            const scriptElement = document.createElement('script');
            scriptElement.src = getScriptPath(script);
            scriptElement.onload = resolve;
            scriptElement.onerror = reject;
            document.body.appendChild(scriptElement);
        });
    }
}

// Migration function to handle data from previous versions
async function migrateData() {
    try {
        console.log('Starting data migration...');
        
        // Get all localStorage keys
        const keys = Object.keys(localStorage);
        const migrationLog = [];
        
        // Migrate roles
        const oldRoles = localStorage.getItem('roles');
        if (oldRoles) {
            try {
                const roles = JSON.parse(oldRoles);
                if (Array.isArray(roles)) {
                    localStorage.setItem('habitus_roles', JSON.stringify(roles));
                    localStorage.removeItem('roles');
                    migrationLog.push('Roles migrated successfully');
                }
            } catch (e) {
                console.error('Error migrating roles:', e);
            }
        }
        
        // Migrate tasks
        const oldTasks = localStorage.getItem('tasks');
        if (oldTasks) {
            try {
                const tasks = JSON.parse(oldTasks);
                if (Array.isArray(tasks)) {
                    // Update task format if needed
                    const updatedTasks = tasks.map(task => {
                        // Log the task for debugging
                        console.log('Migrating task:', task);
                        
                        // Ensure all required fields are present
                        return {
                            id: task.id || Date.now().toString() + Math.random().toString(36).substr(2, 9),
                            description: task.description || task.text || task.name || 'Task without description',
                            role: task.role || 'Unassigned',
                            quadrant: task.quadrant || '1',
                            completed: !!task.completed,
                            createdAt: task.createdAt || new Date().toISOString()
                        };
                    });
                    
                    // Log the updated tasks for debugging
                    console.log('Updated tasks:', updatedTasks);
                    
                    localStorage.setItem('habitus_tasks', JSON.stringify(updatedTasks));
                    localStorage.removeItem('tasks');
                    migrationLog.push('Tasks migrated successfully');
                }
            } catch (e) {
                console.error('Error migrating tasks:', e);
            }
        }
        
        // Migrate metrics
        const oldMetrics = localStorage.getItem('metrics');
        if (oldMetrics) {
            try {
                const metrics = JSON.parse(oldMetrics);
                if (Array.isArray(metrics)) {
                    localStorage.setItem('habitus_metrics', JSON.stringify(metrics));
                    localStorage.removeItem('metrics');
                    migrationLog.push('Metrics migrated successfully');
                }
            } catch (e) {
                console.error('Error migrating metrics:', e);
            }
        }
        
        // Migrate task log
        const oldTasksLog = localStorage.getItem('tasksLog');
        if (oldTasksLog) {
            try {
                const tasksLog = JSON.parse(oldTasksLog);
                if (Array.isArray(tasksLog)) {
                    // Update task log format if needed
                    const updatedTasksLog = tasksLog.map(log => ({
                        timestamp: log.timestamp || Date.now(),
                        tasks: (log.tasks || []).map(task => ({
                            id: task.id || Date.now().toString() + Math.random().toString(36).substr(2, 9),
                            description: task.description || task.text || task.name || 'Task without description',
                            role: task.role || 'Unassigned',
                            quadrant: task.quadrant || '1',
                            completed: !!task.completed,
                            createdAt: task.createdAt || new Date().toISOString()
                        }))
                    }));
                    
                    localStorage.setItem('habitus_tasksLog', JSON.stringify(updatedTasksLog));
                    localStorage.removeItem('tasksLog');
                    migrationLog.push('Task log migrated successfully');
                }
            } catch (e) {
                console.error('Error migrating task log:', e);
            }
        }
        
        // Migrate review
        const oldReview = localStorage.getItem('lastReview');
        if (oldReview) {
            try {
                localStorage.setItem('habitus_lastReview', oldReview);
                localStorage.removeItem('lastReview');
                migrationLog.push('Review migrated successfully');
            } catch (e) {
                console.error('Error migrating review:', e);
            }
        }
        
        // Show migration results
        if (migrationLog.length > 0) {
            App.showNotification('Data migration completed successfully', 'success');
            console.log('Migration log:', migrationLog);
            
            // Refresh the page to apply migrated data
            setTimeout(() => {
                window.location.reload();
            }, 1500);
        } else {
            App.showNotification('No data to migrate found', 'info');
        }
    } catch (error) {
        console.error('Error during data migration:', error);
        App.showNotification('Error during data migration. Please check the console for details.', 'error');
    }
}

// Global error handler
window.onerror = function(msg, url, lineNo, columnNo, error) {
    console.error('Global error:', { msg, url, lineNo, columnNo, error });
    return false;
};

// Initialize application
async function initApp() {
    try {
        console.log('Starting application initialization...');
        
        // Load scripts first
        await loadScripts();
        
        // Wait for all scripts to load
        await new Promise(resolve => {
            if (document.readyState === 'complete') {
                resolve();
            } else {
                window.addEventListener('load', resolve);
            }
        });
        
        // Verify all required modules are available
        const requiredModules = {
            'Translations': window.Translations,
            'Roles': window.Roles,
            'Tasks': window.Tasks,
            'App': window.App
        };
        
        // Log the state of each module
        console.log('Module status:', {
            Translations: !!window.Translations,
            Roles: !!window.Roles,
            Tasks: !!window.Tasks,
            App: !!window.App
        });
        
        const missingModules = Object.entries(requiredModules)
            .filter(([_, module]) => !module)
            .map(([name]) => name);
            
        if (missingModules.length > 0) {
            throw new Error(`Missing required modules: ${missingModules.join(', ')}`);
        }
        
        console.log('All required modules loaded, starting initialization...');
        
        // Initialize modules in correct order with proper error handling
        try {
            // Initialize Translations first
            if (typeof Translations !== 'undefined') {
                console.log('Initializing Translations module...');
                await Translations.init();
                console.log('Translations module initialized');
            } else {
                throw new Error('Translations module not found');
            }
            
            // Initialize Roles
            if (typeof Roles !== 'undefined') {
                console.log('Initializing Roles module...');
                await Roles.init();
                console.log('Roles module initialized');
            } else {
                throw new Error('Roles module not found');
            }
            
            // Initialize Tasks
            if (typeof Tasks !== 'undefined') {
                console.log('Initializing Tasks module...');
                await Tasks.init();
                console.log('Tasks module initialized');
            } else {
                throw new Error('Tasks module not found');
            }
            
            // Initialize App
            if (typeof App !== 'undefined') {
                console.log('Initializing App module...');
                await App.init();
                console.log('App module initialized');
            } else {
                throw new Error('App module not found');
            }
        } catch (initError) {
            console.error('Error during module initialization:', initError);
            throw initError;
        }
        
        // Set up event listeners
        try {
            console.log('Setting up event listeners...');
            document.getElementById('exportMetricsBtn')?.addEventListener('click', Tasks.exportMetrics);
            document.getElementById('exportTasksBtn')?.addEventListener('click', Tasks.exportTasks);
            document.getElementById('migrateDataBtn')?.addEventListener('click', migrateData);
            console.log('Event listeners set up successfully');
        } catch (eventError) {
            console.error('Error setting up event listeners:', eventError);
            throw eventError;
        }
        
        console.log('Application initialized successfully');
    } catch (error) {
        console.error('Error initializing application:', error);
        // Show detailed error to user
        const errorMessage = document.createElement('div');
        errorMessage.className = 'fixed top-0 left-0 right-0 bg-red-500 text-white p-4 text-center z-50';
        errorMessage.innerHTML = `
            <p class="font-bold">Error initializing application</p>
            <p class="text-sm mt-1">${error.message}</p>
            <p class="text-sm mt-1">Please check the console for details and refresh the page.</p>
        `;
        document.body.appendChild(errorMessage);
        
        // Log additional debugging information
        console.log('Current window state:', {
            Translations: !!window.Translations,
            Roles: !!window.Roles,
            Tasks: !!window.Tasks,
            App: !!window.App,
            documentReadyState: document.readyState,
            scriptsLoaded: Array.from(document.scripts).map(s => s.src),
            protocol: window.location.protocol,
            host: window.location.host
        });
    }
}

// Register service worker if running on web server
if (isWebServer()) {
    window.addEventListener('load', async () => {
        try {
            const registration = await navigator.serviceWorker.register(getScriptPath('service-worker.js'), {
                scope: './'
            });
            console.log('ServiceWorker registration successful:', registration);
        } catch (err) {
            console.log('ServiceWorker registration failed:', err);
        }
    });
} else {
    console.log('ServiceWorker not available (running locally)');
}

// Wait for DOM to be ready
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', () => {
        console.log('DOM loaded, starting initialization...');
        initApp();
    });
} else {
    console.log('DOM already loaded, starting initialization...');
    initApp();
}
</script>

